
众所周知，内存管理比较难缠的就是内存碎片的问题，操作系统必须具备可以提供给进程运行时申请和释放任意大小内存的功能，这就是内存的动态分配。

#### 内存碎片的产生原因

	动态分配就不可避免的将会产生内存碎片的问题，内存碎片就是碎片的内存，描述一个系统中所有不可用的空闲内存，内存是空闲的但是不可用，是因为负责动态分配内存的分配算法使得这些空闲的内存无法使用，原因在于这些个空闲内存比较小并且不连续，无法满足内存管理算法中的申请需求。



#### 内存碎片的存在形式

这些内存碎片存在的方式有两种：a. 内部碎片  b. 外部碎片

##### 内部碎片

因为所有的内存分配必须起始于可被4、8或16整除（内存对齐，视处理器体系结构而定）的地址或者因为MMU的分页机制的限制，决定内存分配算法仅能把预定大小的内存块分配客户（前面博文已介绍）。就是分配满足上面对齐条件的最小的大小内存，如果申请的不满足对齐条件，势必会多分配一点不需要的多余内存空间，造成内部碎片。如：申请43Byte，因为没有合适大小的内存，会分配44Byte或48Byte，就会存在1Byte或3Byte的多余空间。



##### 外部碎片

外部碎片的产生：频繁的分配与回收物理页面会导致大量的、连续且小的页面块夹杂在已分配的页面中间，从而产生外部碎片。比如有一块共有100个单位的连续空闲内存空间，范围为0~99，如果从中申请了一块10 个单位的内存块，那么分配出来的就是0~9。这时再继续申请一块 5个单位的内存块，这样分配出来的就是 10~14。如果将第一块释放，此时整个内存块只占用了 10~14区间共 5个单位的内存块。然后再申请20个单位的内存块，此时只能从 15开始，分配15~24区间的内存块，如果以后申请的内存块都大于10个单位，那么 0~9 区间的内存块将不会被使用，变成外部碎片。
