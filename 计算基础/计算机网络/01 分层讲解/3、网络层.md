
# 作用

将分组从源主机经过多次网络和多段链路传输到目的主机

# 核心功能

分组转发和路由选择

## 分组转发

当路由器自己的某个端口得到分组之后，会根据自己维护的一个转发表，根据分组首部中的转发标识在转发表中进行查询，找到合适的接口进行分组转发。

分组首部的转发标识取决于具体的网络：有的是分组的目的地址，有的可能是分组所连接的指示

## 路由选择

源主机和目的主机之间可能存在多条路径，网络层需要决定选择哪一个路径来传输分组，这个就是路由选择。

路由选择的方式：
集中式路由选择：由某个网络控制中心执行路由选择，并向各个路由下载路由信息
分布式路由选择：在每个路由器上运行路由选择协议，各个路由器相互交换路由信息并各自计算路由。
人工路由选择：由网络运维人员配置路由。

注意：路由选择生成的是路由表，路由表一般仅包含从目的网络到下一跳的映射，路由表需要对网络拓扑变化的计算最优化。而转发表是从路由表得出来的，转发表的结构应当使查找过程最优化。


## 国际协议——IP

由于网际层协议IP是TCP/IP 体系结构网络层中的核心协议，因此TCP/IP 体系结构的网络层通常被称为网际层或者IP层，在网际层中，与IP协议配套使用的还有四个协议：
- 地址解析协议 ARP
- 逆地址解析 RARP
- 网际控制报文协议 ICMP
- 网际组控制协议 IGMP

在网际层中，RARP ARP画在IP的下面，这是因为IP协议经常要使用这个协议。ICMP和IGMP画在IP的上面，因为他们需要使用IP协议。

### IPV4 地址与MAC地址

因特网是由众多异构型的物理忘了通过路由器互连而成的逻辑网络。分组从源主机发出后，可能需要经过多个不同的物理网络和路由器才能到达目的主机。

从TCP/IP 体系结构的角度看，IP地址是网际层和以上各层使用的地址，而MAC地址（也称为硬件地址或物理地址）是网络接口层中数据链路层使用的地址，

#### IPV4地址与MAC地址的封装位置

源IP和目的IP被封装在IP数据报（网际层协议数据单元PDU）的首部，而源MAC地址和目的地址呗封装在（数据链路协议数据单元PDU）的首部

#### 数据报传送过程中IPV4地址与MAC地址的变化情况

在分组从源主机发出经过多个路由器转发最终到达目的地址的过程中，源IP地址和目的IP始终保持不变，而源MAC地址和目的MAC地址会逐网络（或者逐链路）变化。

注意：一般主机只有1个接口和一个MAC地址，而路由器至少有2个接口，而每个接口都有一个IP地址和MAC地址。

#### IPV4地址与MAC地址的关系

因特网的网际层使用IP地址进行寻址，路由器中的路由表只记录部分网络的网络地址即可，而不是记录每个网络各个通信设备的各接口的MAC地址。

路由器在收到IP数据报之后，根据其首部中的目的IP地址的网络号部分，基于自己的路由表进行查表转发，这样就能得到IP数据报的下一跳路由器的IP地址。但是此时无法得到该IP对应的MAC地址。


这里需要地址解析协议：通过已知IP地址找到对相应的MAC地址。

#### ARP协议

ARP协议解决同一个局域网上的主机或者路由器的IP地址和MAC地址映射问题，不能跨网络使用。
比如：主机H1与主机H2之间有路由器R1和R2共同2个路由器，当主机H1要给主机H2发送分组时候，会在H1—>R1 R1->R2 R2->H2 这3段链路各使用1次ARP协议




### 问题 为什么要使用IP地址和MAC地址这两种类型的地址共同完成寻址工作，仅使用MAC地址进行通信不可以么？

1）路由器需要记录的内容太多：每台路由器的路由表中就必须记录因特网上所有主机和路由器各个接口的MAC地址

2）海量MAC地址的路由信息需要路由器具备极大的存储空间，并且会给分组的查表转发带来非常大的时延。

3）由于存在异构网络，他们使用不同形式的MAC地址，如果让这些异构网络进行通信，就需要非常复杂的MAC地址转换，但是在网际层使用同一个的IP地址进行寻址，链接到因特网的不同网络中的主机只需要拥有统一的IP地址，他们之间的通信就能像链接再同一个网络上那样简单方便。









## 应用

### Telnet curl 和 ping所在不同的层数

Ping 的原理是 ICMP 协议.




## 子网掩码

为什么需要子网掩码？

***ip地址后面的/24 表示什么意思？***

ip地址后面的斜杠24表示掩码位是24位的，即用32位二进制表示的子网掩码中有连续的24个“1”：11111111 11111111 11111111 00000000，将其转化为十进制，就是：255.255.255.0了。



